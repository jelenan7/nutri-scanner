{% extends "base.html" %}
{% block title %}Smart Search{% endblock %}

{% block content %}

<form method="POST" style="display: flex; justify-content: space-between; gap: 50px; margin-top: 10px;">
  <!-- ================= LEFT: FILTERS ================= -->
  <div style="flex: 1;">

    <!-- product search row -->
    <div style="margin-bottom: 18px; margin-top: -21px; margin-left: -17px;">
      <label style="font-weight: 700; color: #42A475; font-size: 14pt; display:block; margin-bottom: 8px;">
        Product:
      </label>

      <div style="display: flex; align-items: center; gap: 10px;">
        <input
          type="text"
          name="product"
          value="{{ filters.product }}"
          placeholder="e.g. Chocolate, yogurt, milk"
          style="flex: 1; padding: 8px 8px; border: 1px solid #42A475;
                 border-radius: 6px; font-size: 14px; width: 222px;">
        <button type="submit" class="btn-search" name="action" value="search" style="width: 80px; height: 32px;">
          Search
        </button>
      </div>
    </div>

    <!-- nutrient filters + flags -->
    <div style="display: grid; grid-template-columns: 220px 1fr; column-gap: 38px; row-gap: 10px;">

      <!-- LEFT COLUMN – numbers -->
      <div>

        <!-- Sugar -->
        <div style="margin-bottom: 10px;">
          <div style="font-weight: 700; font-size: 12px; color: #555;">
            Sugar (max): <span style="font-weight: 400;">g/100g</span>
          </div>
          <input type="number" step="0.1" name="sugar" value="{{ filters.sugar or '' }}"
                 style="margin-top: 3px; margin-bottom: 8px; width: 170px; padding: 6px 8px;
                 border: 1px solid #42A475; border-radius: 6px; font-size: 13px;">
        </div>

        <!-- Fat -->
        <div style="margin-bottom: 10px;">
          <div style="font-weight: 700; font-size: 12px; color: #555;">
            Fat (max): <span style="font-weight: 400;">g/100g</span>
          </div>
          <input type="number" step="0.1" name="fat" value="{{ filters.fat or '' }}"
                 style="margin-top: 3px; margin-bottom: 8px; width: 170px; padding: 6px 8px;
                 border: 1px solid #42A475; border-radius: 6px; font-size: 13px;">
        </div>

        <!-- Energy -->
        <div style="margin-bottom: 10px;">
          <div style="font-weight: 700; font-size: 12px; color: #555;">
            Energy (max): <span style="font-weight: 400;">kcal/100g</span>
          </div>
          <input type="number" step="1" name="energy" value="{{ filters.energy or '' }}"
                 style="margin-top: 3px; width: 170px; margin-bottom: 8px; padding: 6px 8px;
                 border: 1px solid #42A475; border-radius: 6px; font-size: 13px;">
        </div>

        <!-- Carbs -->
        <div style="margin-bottom: 10px;">
          <div style="font-weight: 700; font-size: 12px; color: #555;">
            Carbohydrates (max): <span style="font-weight: 400;">g/100g</span>
          </div>
          <input type="number" step="0.1" name="carbs" value="{{ filters.carbs or '' }}"
                 style="margin-top: 3px; margin-bottom: 8px; width: 170px; padding: 6px 8px;
                 border: 1px solid #42A475; border-radius: 6px; font-size: 13px;">
        </div>

        <!-- Protein -->
        <div style="margin-top: 6px;">
          <div style="font-weight: 700; font-size: 12px; color: #555;">
            Protein (max): <span style="font-weight: 400;">g/100g</span>
          </div>
          <input type="number" step="0.1" name="protein" value="{{ filters.protein or '' }}"
                 style="margin-top: 3px;margin-bottom: 8px; width: 170px; padding: 6px 8px;
                 border: 1px solid #42A475; border-radius: 6px; font-size: 13px;">
        </div>

      </div>

      <!-- RIGHT COLUMN – checkboxes -->
      <div style="display: flex; flex-direction: column; gap: 11px; margin-top: 14px;">

        <label style="display:flex; align-items:center; gap:6px; font-size: 13px;">
          <input type="checkbox" name="available_mne" style="accent-color: #42A475;"
            {% if filters.available_mne %}checked{% endif %}>
          <span>Available in MNE</span>
        </label>

        <label style="display:flex; align-items:center; gap:6px; font-size: 13px;">
          <input type="checkbox" name="vegan" style="accent-color: #42A475;"
            {% if filters.vegan %}checked{% endif %}>
          <span>Vegan</span>
        </label>

        <label style="display:flex; align-items:center; gap:6px; font-size: 13px;">
          <input type="checkbox" name="lactose_free" style="accent-color: #42A475;" 
            {% if filters.lactose_free %}checked{% endif %}>
          <span>Lactose Free</span>
        </label>

        <label style="display:flex; align-items:center; gap:6px; font-size: 13px;">
          <input type="checkbox" name="gluten_free" style="accent-color: #42A475;"
            {% if filters.gluten_free %}checked{% endif %}>
          <span>Gluten Free</span>
        </label>

      </div>
    </div>

  </div>

  <!-- ================= RIGHT: RESULTS ================= -->
  <div style="flex: 1; border: 1px solid #42A475; border-radius: 10px;
              background: #f9f9f9; padding: 18px 18px; min-height: 350px; margin-left: 55px;">

    {% if selected_product %}
      <!-- ========== DETALJI PROIZVODA ========== -->
      <div style="display:flex; gap:25px;">
        <div style="flex-shrink:0;">
          {% if selected_product.selected_images and selected_product.selected_images.front %}
            <img src="{{ selected_product.selected_images.front.display.en }}"
                 style="width: 200px; height:200px; object-fit:cover; border:1px solid #000;">
          {% else %}
            <div style="width:180px; height:180px; background:#EEE; display:flex;
                        align-items:center; justify-content:center; border:1px solid #000;">
              No image
            </div>
          {% endif %}
        </div>

        <div style="line-height:1.7; font-size:15px;">
          <p><strong>{{ selected_product.product_name or "Unnamed product" }}</strong></p>
          <p><strong>Per 100g:</strong></p>
          <p>Energy: {{ selected_product.nutriments["energy-kcal_100g"] or "?" }} kcal</p>
          <p>Fat: {{ selected_product.nutriments["fat_100g"] or "?" }} g</p>
          <p>Carbs: {{ selected_product.nutriments["carbohydrates_100g"] or "?" }} g</p>
          <p>Protein: {{ selected_product.nutriments["proteins_100g"] or "?" }} g</p>
          <p>Sugars: {{ selected_product.nutriments["sugars_100g"] or "?" }} g</p>
        </div>
      </div>

      <div style="margin-top:15px; text-align:right;">
        <button type="submit" class="btn-search" style="width: 100px;" name="action" value="back">
          Back to list
        </button>
      </div>

    {% else %}
      <!-- ========== LISTA 7 PROIZVODA ========== -->
      {% if products %}
        <ol style="margin-left: 18px; line-height: 1.6;">
          {% for p in products %}
            <li style="margin-bottom: 10px;">
              <button
                type="submit"
                name="action"
                value="details:{{ p.code }}"
                style="border:none; background:none; padding:0; text-align:left;
                       cursor:pointer; color:#42A475; font-weight:600;"
              >
                {{ p.product_name or "Unnamed product" }}
              </button>

              <div style="font-size:13px; color:#555; margin-left:5px;">
                {{ p.nutriments["energy-kcal_100g"] or "?" }} kcal |
                sugar: {{ p.nutriments["sugars_100g"] or "?" }} g |
                fat: {{ p.nutriments["fat_100g"] or "?" }} g |
                protein: {{ p.nutriments["proteins_100g"] or "?" }} g
              </div>
            </li>
          {% endfor %}
        </ol>


        <div style="text-align: right; margin-top: 20px;">
          <button type="submit" class="btn-search" name="action" style="width: 80px;" value="refresh">
            Refresh
          </button>
        </div>
      {% else %}
        <p style="color:gray; text-align: center;">
          Enter filters and click <strong>Search</strong> to see matching products.
        </p>
      {% endif %}
    {% endif %}
  </div>

  <!-- current page -->
  <input type="hidden" name="page" value="{{ page }}">

</form>
<script src="{{ url_for('static', filename='js/validation_form.js') }}"></script>
<style>
  body {
    position: relative;
    min-height: 100vh;
    margin: 0;
  }

  body::before {
    content: "";
    position: fixed;
    inset: 0;
    background-image: url("{{ url_for('static', filename='logo2.png') }}"); /* tvoj logo */
    background-size: 900px auto;   /* veličina “pločice” sa logom */
    background-repeat:no-repeat;     /* šara po cijeloj stranici */
    background-position: center 5px;
    opacity: 0.03;                 /* veoma blago, da ne smeta tekstu */
    z-index: -1;                   
    pointer-events: none;
  }
</style>

{% endblock %}
